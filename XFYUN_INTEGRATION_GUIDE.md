# 科大讯飞星火实时语音转写集成指南

## 概述

本项目已成功集成科大讯飞星火实时语音转写功能，支持实时语音识别和转录。使用您提供的APPID和APIKey配置。

## 配置信息

- **APPID**: 84959f16
- **APIKey**: 065eee5163baa4692717b923323e6853
- **服务商**: 科大讯飞星火
- **类型**: 实时语音转写

## 新增功能

### 1. 服务器端代理
- 添加了WebSocket代理服务 (`/xfyun-proxy`)
- 处理科大讯飞API鉴权
- 转发音频数据和转录结果
- 状态检查接口 (`/api/xfyun/status`)

### 2. 前端客户端
- 新增 `xfyun-realtime-transcription.js` 客户端
- 支持实时音频录制和转录
- 自动连接代理服务器
- 集成现有消息系统

### 3. 用户界面
- 在实时转录面板添加"科大讯飞转录"按钮
- 蓝色按钮样式，区别于其他转录方式
- 录音时按钮变红色表示正在工作

## 使用方法

### 启动服务器

1. 安装依赖（如果是新环境）：
```bash
cd server
npm install
```

2. 启动服务器：
```bash
cd server
npm start
```

### 使用转录功能

1. 打开浏览器访问应用
2. 输入用户名加入房间
3. 在左侧"实时转录"面板中：
   - 点击"科大讯飞转录"按钮开始录音
   - 说话时会实时显示转录结果
   - 再次点击按钮停止录音

## 技术架构

```
浏览器 ←→ 本地服务器 ←→ 科大讯飞API
     WebSocket       WebSocket
```

### 数据流程
1. 浏览器录制音频 → PCM16格式
2. 通过WebSocket发送到本地代理
3. 代理服务器处理鉴权并转发到科大讯飞
4. 科大讯飞返回转录结果
5. 代理转发结果到浏览器
6. 浏览器显示转录文本并广播给其他用户

## 文件说明

### 新增文件
- `xfyun-realtime-transcription.js` - 科大讯飞客户端
- `XFYUN_INTEGRATION_GUIDE.md` - 本说明文档

### 修改文件
- `server/server.js` - 添加科大讯飞代理功能
- `server/package.json` - 添加express-ws依赖
- `index.html` - 添加按钮和脚本引用
- `styles.css` - 添加按钮样式

## 故障排除

### 1. 转录服务连接失败
- 检查网络连接
- 确认APPID和APIKey正确
- 查看服务器日志

### 2. 麦克风权限问题
- 确保浏览器允许麦克风访问
- 在HTTPS或localhost环境下使用

### 3. 转录结果为空
- 检查说话音量
- 确认语言为中文
- 检查麦克风工作状态

## 测试步骤

1. **服务器测试**：
```bash
# 检查科大讯飞状态
curl http://localhost:3001/api/xfyun/status
```

2. **前端测试**：
- 打开浏览器开发者工具
- 查看控制台日志
- 点击"科大讯飞转录"按钮
- 观察WebSocket连接状态

3. **功能测试**：
- 确保麦克风权限已授权
- 开始录音并说话
- 观察是否有实时转录结果
- 检查转录文本是否准确

## 注意事项

1. **浏览器兼容性**：需要支持WebRTC和WebSocket的现代浏览器
2. **网络要求**：需要稳定的网络连接
3. **音频质量**：建议在安静环境下测试
4. **并发限制**：根据科大讯飞API限制调整使用频率

## 成功标志

当看到以下情况时，表示集成成功：
- ✅ 科大讯飞转录按钮显示为蓝色
- ✅ 点击按钮后连接到转录服务
- ✅ 录音时按钮变红色
- ✅ 实时显示转录文本
- ✅ 转录结果发送给其他用户

---

**配置完成时间**: ${new Date().toLocaleString('zh-CN')}
**集成版本**: v1.0.0
**技术支持**: 科大讯飞星火实时语音转写API